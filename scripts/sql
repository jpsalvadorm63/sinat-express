drop view lp ;
drop view sinat ;
create view lp as select * from predio where origen = 'LP' ;
create view sinat as select * from predio where origen = 'SINAT' ;
select
  lp.cod_catastral,
  sinat.cod_catastral,
  lp.cod_anterior,
  sinat.cod_anterior,
  lp.ciudad_notificacion,
  sinat.ciudad_notificacion,
  lp.calle_notificaciones,
  sinat.calle_notificaciones,
  lp.canton_notificaciones,
  sinat.canton_notificaciones,
  lp.parroquia_notificacion,
  sinat.parroquia_notificacion,
  lp.numero_notificacion,
  sinat.numero_notificacion,
  lp.recibe_notificaciones,
  sinat.recibe_notificaciones,
  lp.piso_notificacion,
  sinat.piso_notificacion,
  lp.nombre_predio,
  sinat.nombre_predio,
  lp.sector,
  sinat.sector,
  lp.telefono,
  sinat.telefono,
  lp.tiene_nombre,
  sinat.tiene_nombre,
  lp.tipo_telefono,
  sinat.tipo_telefono,
  lp.titulo,
  sinat.titulo
from
  lp full join sinat on lp.cod_catastral = sinat.cod_catastral
where
     lp.cod_catastral is null
  or sinat.cod_catastral is null
  or lp.cod_anterior <> sinat.cod_anterior
  or lp.ciudad_notificacion <> sinat.ciudad_notificacion
  or lp.calle_notificaciones <> sinat.calle_notificaciones
  -- or lp.canton_notificaciones <> sinat.canton_notificaciones
  or lp.numero_notificacion <> sinat.numero_notificacion
  or lp.nombre_predio <> sinat.nombre_predio
  -- or lp.recibe_notificaciones <> sinat.recibe_notificaciones
  or lp.piso_notificacion <> sinat.piso_notificacion
  -- or lp.parroquia_notificacion <> sinat.parroquia_notificacion
  or lp.sector <> sinat.sector
  or lp.telefono <> sinat.telefono
  -- or lp.tiene_nombre <> sinat.tiene_nombre
  -- or lp.tipo_telefono <> sinat.tipo_telefono
  -- or lp.titulo <> sinat.titulo
  or lp.observaciones <> sinat.observaciones
;

//
// -- se corre este script una vez que se ha creado la tabla en la base de datos
//
// select dropGeometryColumn('public','fichacampo','geom');
// select addGeometryColumn('public','fichacampo','geom',32717,'POINT',2);
// UPDATE fichacampo
//   SET geom = ST_Transform(ST_GeomFromText('POINT(' || coordenadax || ' ' || coordenaday || ')',32717), 32717)
//   WHERE coordenadax is not null and coordenaday is not null ;

-- DROP FUNCTION updatePuntosXY() ;
-- CREATE FUNCTION updatePuntosXY() RETURNS integer AS $$
-- DECLARE
-- BEGIN
--     UPDATE fichacampo
--       SET geom = ST_Transform(ST_GeomFromText('POINT(' || coordenadax || ' ' || coordenaday || ')',32717), 32717)
--       WHERE coordenadax is not null and coordenaday is not null ;
--
--     RETURN 32717;
-- END;
-- $$ LANGUAGE plpgsql;
-- SELECT updatePuntosXY()